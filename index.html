<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egzamin ≈öwiƒôtych</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { color: #333; margin-bottom: 10px; text-align: center; }

        /* --- Nawigacja (Zak≈Çadki) --- */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background-color: #e9ecef;
            color: #495057;
            cursor: pointer;
            border-radius: 20px;
            font-weight: bold;
            transition: 0.3s;
        }

        .nav-btn.active {
            background-color: #dc3545; /* Czerwony dla hardcore */
            color: white;
            box-shadow: 0 4px 6px rgba(220, 53, 69, 0.3);
        }
        
        /* Styl dla pierwszych trzech przycisk√≥w (niebieski) */
        .nav-btn:not(:last-child).active {
            background-color: #007bff;
            box-shadow: 0 4px 6px rgba(0,123,255,0.3);
        }

        /* --- Kontenery G≈Ç√≥wne --- */
        .view-section {
            display: none;
            width: 100%;
            max-width: 800px;
            flex-direction: column;
            align-items: center;
        }
        
        .view-section.active-view {
            display: flex;
        }

        /* --- Style wsp√≥lne --- */
        .filter-container { margin-bottom: 20px; text-align: center; width: 100%; }
        select.main-select { padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; width: 100%; max-width: 300px; }
        
        .scene { width: 100%; max-width: 500px; height: 320px; perspective: 1000px; cursor: pointer; margin-bottom: 20px; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border-radius: 15px; }
        .card.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; border-radius: 15px; background-color: white; text-align: center; }
        .card-face.front { background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); color: #333; border: 2px solid #007bff; }
        .card-face.back { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; transform: rotateY(180deg); }
        .main-text { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .hint { font-size: 12px; opacity: 0.6; margin-top: 20px; text-transform: uppercase; }
        .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        
        /* --- Style dla Quiz√≥w --- */
        .quiz-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            text-align: center;
        }
        .quiz-question { font-size: 22px; margin-bottom: 25px; font-weight: bold; color: #333; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .option-btn { padding: 15px; border: 2px solid #e9ecef; background: #fff; border-radius: 8px; cursor: pointer; font-size: 16px; transition: 0.2s; text-align: left; }
        .option-btn:hover { background-color: #f8f9fa; border-color: #ced4da; }
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; padding: 12px; font-size: 16px; border: 2px solid #ccc; border-radius: 5px; }
        .check-btn { padding: 12px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .feedback-msg { margin-top: 15px; font-weight: bold; min-height: 24px; }
        .feedback-msg.success { color: #28a745; }
        .feedback-msg.error { color: #dc3545; }
        .next-q-btn { margin-top: 20px; padding: 10px 30px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; display: none; }
        .score-board { margin-top: 20px; font-size: 18px; color: #666; }
        .category-badge { background-color: #e9ecef; color: #495057; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; margin-bottom: 15px; display: inline-block; }

        /* --- Style dla EGZAMINU PISEMNEGO (NOWO≈öƒÜ) --- */
        .match-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
            margin-bottom: 20px;
        }
        
        .match-row {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Atrybut | Input */
            gap: 15px;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .match-attr { font-weight: bold; font-size: 16px; color: #333; }
        
        .match-input {
            padding: 10px;
            border: 2px solid #ced4da;
            border-radius: 5px;
            width: 100%;
            background-color: white;
            font-size: 15px;
            box-sizing: border-box; /* Wa≈ºne ≈ºeby input nie wystawa≈Ç */
        }

        .match-input.correct { border-color: #28a745; background-color: #d4edda; }
        .match-input.wrong { border-color: #dc3545; background-color: #f8d7da; }

        .correct-answer-text {
            display: none;
            color: #dc3545;
            font-size: 13px;
            margin-top: 5px;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .match-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            .match-input { margin-top: 5px; }
        }
    </style>
</head>
<body>

    <h1>Nauka ≈öwiƒôtych</h1>

    <div class="filter-container">
        <label for="categoryFilter" style="display:block; margin-bottom: 5px; font-weight: bold; color: #555;">Wybierz zakres:</label>
        <select id="categoryFilter" class="main-select" onchange="changeCategory()">
            <option value="apostolowie">1. Dwunastu Aposto≈Ç√≥w (Start)</option>
            <option value="biblijne">2. Postacie Biblijne i Ewangeli≈õci</option>
            <option value="ojcowie">3. Ojcowie Ko≈õcio≈Ça</option>
            <option value="wspomozyciele">4. Czternastu Wspomo≈ºycieli</option>
            <option value="meczennicy">5. Mƒôczennicy i Mƒôczennice</option>
            <option value="zakonnicy">6. Zakonnicy i Za≈Ço≈ºyciele</option>
            <option value="biskupi">7. Biskupi i Patroni Polski</option>
            <option value="all">Wszyscy ≈õwiƒôci (Ca≈Ça baza)</option>
        </select>
    </div>

    <!-- Zak≈Çadki -->
    <div class="nav-tabs">
        <button class="nav-btn active" onclick="switchView('fiszki')">1. Fiszki</button>
        <button class="nav-btn" onclick="switchView('quiz-select')">2. Quiz: Wybierz Atrybut</button>
        <button class="nav-btn" onclick="switchView('quiz-type')">3. Quiz: Wpisz Imiƒô</button>
        <button class="nav-btn" onclick="switchView('test-write')">4. Egzamin Pisemny</button>
    </div>

    <!-- WIDOK 1: FISZKI -->
    <div id="view-fiszki" class="view-section active-view">
        <div class="controls">
            <button onclick="toggleMode()" id="modeBtn" style="background-color: #28a745;">Tryb: Imiƒô -> Atrybut</button>
        </div>
        <div class="scene scene--card" onclick="flipCard()">
            <div class="card" id="card">
                <div class="card-face front">
                    <div class="category-badge" id="front-category">Kategoria</div>
                    <div class="main-text" id="front-text">≈Åadowanie...</div>
                    <div class="hint">(kliknij, aby obr√≥ciƒá)</div>
                </div>
                <div class="card-face back">
                    <div class="category-badge" style="background-color: rgba(255,255,255,0.2); color: white;">Odpowied≈∫</div>
                    <div class="main-text" id="back-text">≈Åadowanie...</div>
                </div>
            </div>
        </div>
        <div class="controls">
            <button onclick="prevCard()" class="secondary">Poprzednia</button>
            <button onclick="shuffleDeck(currentDeck); currentIndex=0; updateCard();" style="background-color: #ffc107; color: black;">Pomieszaj</button>
            <button onclick="nextCard()" class="secondary">Nastƒôpna</button>
        </div>
        <div style="margin-top: 10px; color: #666;" id="fiszki-counter">0 / 0</div>
    </div>

    <!-- WIDOK 2: QUIZ WYBORU -->
    <div id="view-quiz-select" class="view-section">
        <div class="quiz-card">
            <div class="category-badge" id="qs-cat">Kategoria</div>
            <div class="quiz-question" id="qs-question">Pytanie...</div>
            <div class="options-grid" id="qs-options"></div>
            <div class="feedback-msg" id="qs-feedback"></div>
            <button class="next-q-btn" id="qs-next" onclick="nextQuizQuestion('select')">Nastƒôpne pytanie</button>
        </div>
        <div class="score-board">Wynik: <span id="qs-score">0</span></div>
    </div>

    <!-- WIDOK 3: QUIZ PISANIA (pojedynczy) -->
    <div id="view-quiz-type" class="view-section">
        <div class="quiz-card">
            <div class="category-badge" id="qt-cat">Kategoria</div>
            <div class="quiz-question" id="qt-question">Pytanie...</div>
            <p style="margin-top: -15px; margin-bottom: 20px; font-size: 14px; color: #666;">Kto ma taki atrybut?</p>
            <div class="input-group">
                <input type="text" id="qt-input" placeholder="Wpisz imiƒô..." autocomplete="off">
                <button class="check-btn" onclick="checkTypeAnswer()">Sprawd≈∫</button>
            </div>
            <div class="feedback-msg" id="qt-feedback"></div>
            <button class="next-q-btn" id="qt-next" onclick="nextQuizQuestion('type')">Nastƒôpne pytanie</button>
        </div>
        <div class="score-board">Wynik: <span id="qt-score">0</span></div>
    </div>

    <!-- WIDOK 4: EGZAMIN PISEMNY (LISTA) -->
    <div id="view-test-write" class="view-section">
        <div class="quiz-card" style="max-width: 900px;">
            <h2 style="color: #dc3545;">Egzamin Pisemny</h2>
            <p style="color:#666; margin-bottom:20px;">Wpisz imiƒô ≈õwiƒôtego, kt√≥ry posiada dany atrybut. Wielko≈õƒá liter nie ma znaczenia.</p>
            
            <div id="write-container" class="match-list">
                <!-- Tu wygenerujƒÖ siƒô wiersze -->
            </div>

            <button class="check-btn" onclick="checkWriteTest()" style="width: 100%; font-size: 18px; margin-bottom: 10px;">Sprawd≈∫ odpowiedzi</button>
            <button class="secondary" onclick="renderWriteTest()" style="width: 100%;">Nowy test (Zresetuj)</button>
            
            <div class="score-board" id="write-score"></div>
        </div>
    </div>

<script>
    // --- DANE ---
    const database = [
        // APOSTO≈ÅOWIE
        { name: "≈öw. Piotr", attr: "1 lub 2 klucze", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Andrzej", attr: "Uko≈õny krzy≈º", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Jakub Starszy", attr: "Str√≥j pielgrzymi, kapelusz z muszlƒÖ", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Jan Ewangelista", attr: "Bez brody, kielich z wƒô≈ºem", label: "Aposto≈Ç / Ewangelista", group: "apostolowie" },
        { name: "≈öw. Bart≈Çomiej", attr: "Zdarta sk√≥ra, n√≥≈º", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Jakub M≈Çodszy", attr: "Proporzec, kij foluszniczy", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Filip", attr: "Krzy≈º w kszta≈Çcie T (Antoniego)", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Tomasz", attr: "KƒÖtownik, w≈Ç√≥cznia", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Mateusz", attr: "KƒÖtownik, top√≥r, halabarda", label: "Aposto≈Ç / Ewangelista", group: "apostolowie" },
        { name: "≈öw. Szymon", attr: "Pi≈Ça", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Juda Tadeusz", attr: "Maczuga, kamienie", label: "Aposto≈Ç", group: "apostolowie" },
        { name: "≈öw. Maciej", attr: "Top√≥r", label: "Aposto≈Ç (za Judasza)", group: "apostolowie" },
        { name: "≈öw. Pawe≈Ç", attr: "Miecz", label: "Aposto≈Ç Narod√≥w", group: "apostolowie" },

        // BIBLIJNE
        { name: "≈öw. Jan Chrzciciel", attr: "W sk√≥rze, baranek, g≈Çowa na misie", label: "Prorok", group: "biblijne" },
        { name: "≈öw. Maria Magdalena", attr: "Pojemniczek na perfumy, w≈Çosy", label: "Uczennica", group: "biblijne" },
        { name: "Micha≈Ç Archanio≈Ç", attr: "Skrzydlaty, ze smokiem, waga, zbroja", label: "Archanio≈Ç", group: "biblijne" },
        { name: "Symbol ≈õw. Mateusza", attr: "Cz≈Çowiek (Anio≈Ç)", label: "Ewangelista", group: "biblijne" },
        { name: "Symbol ≈õw. Marka", attr: "Lew", label: "Ewangelista", group: "biblijne" },
        { name: "Symbol ≈õw. ≈Åukasza", attr: "W√≥≈Ç", label: "Ewangelista", group: "biblijne" },
        { name: "Symbol ≈õw. Jana", attr: "Orze≈Ç", label: "Ewangelista", group: "biblijne" },

        // OJCOWIE
        { name: "≈öw. Ambro≈ºy", attr: "Biskup (czƒôsto z ulem)", label: "Ojciec Ko≈õcio≈Ça", group: "ojcowie" },
        { name: "≈öw. Grzegorz Wielki", attr: "Papie≈º z hostiƒÖ, go≈Çƒôbica", label: "Ojciec Ko≈õcio≈Ça", group: "ojcowie" },
        { name: "≈öw. Augustyn", attr: "Biskup, anio≈Çek szepcze do ucha, serce", label: "Ojciec Ko≈õcio≈Ça", group: "ojcowie" },
        { name: "≈öw. Hieronim", attr: "Kapelusz kardynalski, ksiƒôga, lew", label: "Ojciec Ko≈õcio≈Ça", group: "ojcowie" },

        // WSPOMO≈ªYCIELE
        { name: "≈öw. Jerzy", attr: "Smok, rycerz na koniu", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. B≈Ça≈ºej", attr: "Skrzy≈ºowane ≈õwiece", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Erazm", attr: "Pow√≥j z kiszkami", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Pantaleon", attr: "Gwo≈∫dzie / rƒôce przygwo≈ºd≈ºone do g≈Çowy", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Wit", attr: "Kogut, kocio≈Ç", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Krzysztof", attr: "Dzieciƒô Jezus na barkach", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Dionizy", attr: "Uciƒôta g≈Çowa w rƒôkach", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Cyriak", attr: "Diabe≈Ç (uwiƒÖzany)", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Achacy", attr: "Ga≈ÇƒÖ≈∫ cierniowa", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Eustachy", attr: "Jele≈Ñ z krzy≈ºem w poro≈ºu", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Idzi", attr: "≈Åania", label: "Wspomo≈ºyciel", group: "wspomozyciele" },
        { name: "≈öw. Ma≈Çgorzata", attr: "Smok na ≈Ça≈Ñcuchu", label: "Wspomo≈ºycielka", group: "wspomozyciele" },
        { name: "≈öw. Barbara", attr: "Wie≈ºa, kielich i hostia", label: "Wspomo≈ºycielka", group: "wspomozyciele" },
        { name: "≈öw. Katarzyna Aleksandryjska", attr: "Miecz i ko≈Ço", label: "Wspomo≈ºycielka", group: "wspomozyciele" },

        // MƒòCZENNICY
        { name: "≈öw. Agata", attr: "Piersi na tacy lub w szczypcach", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. Agnieszka", attr: "Baranek, 2 korony", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. ≈Åucja", attr: "Oczy na talerzu, miecz, szyja", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. Apolonia", attr: "Szczypce z zƒôbem", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. Dorota", attr: "Koszyczek z kwiatami/jab≈Çkami", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. Urszula", attr: "Strza≈Çy, p≈Çaszcz ochronny", label: "Mƒôczennica", group: "meczennicy" },
        { name: "≈öw. Sebastian", attr: "Strza≈Çy (przywiƒÖzany do drzewa)", label: "Mƒôczennik", group: "meczennicy" },
        { name: "≈öw. Wawrzyniec", attr: "Krata (ruszt), dalmatyka", label: "Mƒôczennik", group: "meczennicy" },
        { name: "≈öw. Wincenty", attr: "Str√≥j diakona, kruk, kamie≈Ñ m≈Çy≈Ñski", label: "Mƒôczennik", group: "meczennicy" },
        { name: "≈öw. Szczepan", attr: "Kamienie", label: "Mƒôczennik", group: "meczennicy" },
        { name: "≈öw. Maurycy", attr: "Czarnosk√≥ry rycerz", label: "Mƒôczennik", group: "meczennicy" },

        // ZAKONNICY
        { name: "≈öw. Antoni Pustelnik", attr: "Szaty mnicha, krzy≈º T, ≈õwinka", label: "Pustelnik", group: "zakonnicy" },
        { name: "≈öw. Franciszek z Asy≈ºu", attr: "Stygmaty, ptaki, brƒÖzowy habit", label: "Franciszkanin", group: "zakonnicy" },
        { name: "≈öw. Antoni Padewski", attr: "DzieciƒÖtko Jezus, lilia", label: "Franciszkanin", group: "zakonnicy" },
        { name: "≈öw. Klara", attr: "Monstrancja", label: "Klaryska", group: "zakonnicy" },
        { name: "≈öw. Dominik", attr: "Pies z pochodniƒÖ, lilia, r√≥≈ºaniec", label: "Dominikanin", group: "zakonnicy" },
        { name: "≈öw. Tomasz z Akwinu", attr: "S≈Ço≈Ñce na piersiach, ksiƒôga, ko≈õci√≥≈Ç", label: "Dominikanin", group: "zakonnicy" },
        { name: "≈öw. Katarzyna Siene≈Ñska", attr: "Dominikanka z koronƒÖ cierniowƒÖ", label: "Dominikanka", group: "zakonnicy" },
        { name: "≈öw. Kajetan", attr: "Klƒôczy przed DzieciƒÖtkiem", label: "Zakonnik", group: "zakonnicy" },
        { name: "≈öw. Ryta", attr: "Cier≈Ñ na czole, figa, pszczo≈Çy", label: "Augustianka", group: "zakonnicy" },
        { name: "≈öw. Scholastyka", attr: "Go≈ÇƒÖb na ksiƒôdze", label: "Benedyktynka", group: "zakonnicy" },
        { name: "≈öw. Jan Nepomucen", attr: "5 gwiazd, kom≈ºa, stu≈Ça, jƒôzyk", label: "KsiƒÖdz", group: "zakonnicy" },
        { name: "Salomea", attr: "Mniszka z monstrancjƒÖ", label: "Klaryska", group: "zakonnicy" },
        { name: "≈öw. Gertruda", attr: "P≈Çaszcz gronostajowy, myszy", label: "Mniszka", group: "zakonnicy" },

        // BISKUPI
        { name: "≈öw. Miko≈Çaj", attr: "Trzy z≈Çote kule, str√≥j biskupa", label: "Biskup", group: "biskupi" },
        { name: "≈öw. Stanis≈Çaw", attr: "Biskup, wskrzeszony Piotrowin", label: "Patron Polski", group: "biskupi" },
        { name: "≈öw. Wojciech", attr: "Biskup, wios≈Ço, pastora≈Ç", label: "Patron Polski", group: "biskupi" },
        { name: "≈öw. Marcin", attr: "Na koniu, dzieli p≈Çaszcz z ≈ºebrakiem", label: "Biskup", group: "biskupi" },
        { name: "≈öw. Roch", attr: "Pies z chlebem, rana na nodze", label: "Pielgrzym", group: "biskupi" },
        { name: "≈öw. Florian", attr: "Oficer gaszƒÖcy po≈ºar wodƒÖ", label: "≈ªo≈Çnierz", group: "biskupi" },
        { name: "≈öw. Jadwiga ≈ölƒÖska", attr: "Trzyma ko≈õci√≥≈Ç, buty w rƒôce", label: "Ksiƒô≈ºna", group: "biskupi" },
        { name: "≈öw. El≈ºbieta z Turyngii", attr: "Korona, ≈ºebrak, r√≥≈ºe", label: "Ksiƒô≈ºna", group: "biskupi" },
        { name: "≈öw. Norbert", attr: "R√≥≈ºaniec, jab≈Çko kr√≥lewskie", label: "Biskup", group: "biskupi" },
        { name: "≈öw. Eligiusz", attr: "M≈Çoteczek cyzelatorski", label: "Biskup", group: "biskupi" },
        { name: "≈öw. Otylia", attr: "Oczy na ksiƒôdze lub sztylet", label: "≈öwiƒôta", group: "biskupi" },
        { name: "≈öw. Feliks", attr: "PajƒÖk, pajƒôczyna", label: "≈öwiƒôty", group: "biskupi" },
        { name: "≈öw. Krystyn", attr: "Szewc (narzƒôdzia)", label: "≈öwiƒôty", group: "biskupi" }
    ];

    let currentDeck = [];
    let currentIndex = 0;
    let fiszkiMode = "nameToAttr"; 
    
    // Quiz Vars
    let qsCurrentItem = null;
    let qsScore = 0;
    let qtCurrentItem = null;
    let qtScore = 0;

    function init() {
        changeCategory();
    }

    function changeCategory() {
        const filterVal = document.getElementById('categoryFilter').value;
        if (filterVal === "all") {
            currentDeck = [...database];
        } else {
            currentDeck = database.filter(item => item.group === filterVal);
        }
        
        currentIndex = 0;
        qsScore = 0; document.getElementById('qs-score').innerText = 0;
        qtScore = 0; document.getElementById('qt-score').innerText = 0;

        shuffleDeck(currentDeck);
        updateCard(); 
        nextQuizQuestion('select'); 
        nextQuizQuestion('type'); 
        
        // Zresetuj te≈º test pisemny
        renderWriteTest();
    }

    function shuffleDeck(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    function switchView(viewName) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
        document.getElementById('view-' + viewName).classList.add('active-view');
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        
        // Map button index
        const btns = document.querySelectorAll('.nav-btn');
        if(viewName === 'fiszki') btns[0].classList.add('active');
        if(viewName === 'quiz-select') btns[1].classList.add('active');
        if(viewName === 'quiz-type') btns[2].classList.add('active');
        if(viewName === 'test-write') btns[3].classList.add('active');
    }

    // --- FISZKI ---
    const cardElement = document.getElementById('card');
    const frontText = document.getElementById('front-text');
    const backText = document.getElementById('back-text');
    const frontCat = document.getElementById('front-category');
    const fCounter = document.getElementById('fiszki-counter');
    const modeBtn = document.getElementById('modeBtn');

    function updateCard() {
        if (currentDeck.length === 0) return;
        const item = currentDeck[currentIndex];
        cardElement.classList.remove('is-flipped');
        setTimeout(() => {
            if (fiszkiMode === "nameToAttr") {
                frontText.innerText = item.name;
                backText.innerText = item.attr;
            } else {
                frontText.innerText = item.attr;
                backText.innerText = item.name;
            }
            frontCat.innerText = item.label;
            fCounter.innerText = `${currentIndex + 1} / ${currentDeck.length}`;
        }, 200);
    }
    function flipCard() { if (currentDeck.length > 0) cardElement.classList.toggle('is-flipped'); }
    function nextCard() { if (currentDeck.length===0) return; currentIndex = (currentIndex < currentDeck.length - 1) ? currentIndex + 1 : 0; updateCard(); }
    function prevCard() { if (currentDeck.length===0) return; currentIndex = (currentIndex > 0) ? currentIndex - 1 : currentDeck.length - 1; updateCard(); }
    function toggleMode() {
        fiszkiMode = fiszkiMode === "nameToAttr" ? "attrToName" : "nameToAttr";
        modeBtn.innerText = fiszkiMode === "nameToAttr" ? "Tryb: Imiƒô -> Atrybut" : "Tryb: Atrybut -> Imiƒô";
        modeBtn.style.backgroundColor = fiszkiMode === "nameToAttr" ? "#28a745" : "#17a2b8";
        cardElement.classList.remove('is-flipped');
        updateCard();
    }

    // --- QUIZ FUNCTIONS ---
    function getRandomItem() {
        if (currentDeck.length === 0) return null;
        return currentDeck[Math.floor(Math.random() * currentDeck.length)];
    }
    function getDistractors(correctItem) {
        let distractors = [];
        let attempts = 0;
        while (distractors.length < 3 && attempts < 100) {
            let rand = getRandomItem();
            if (rand.name !== correctItem.name && !distractors.includes(rand)) {
                distractors.push(rand);
            }
            attempts++;
        }
        return distractors;
    }
    function nextQuizQuestion(type) {
        if (currentDeck.length === 0) return;
        if (type === 'select') {
            qsCurrentItem = getRandomItem();
            const distractors = getDistractors(qsCurrentItem);
            let options = [qsCurrentItem, ...distractors];
            shuffleDeck(options);
            document.getElementById('qs-cat').innerText = qsCurrentItem.label;
            document.getElementById('qs-question').innerText = qsCurrentItem.name;
            document.getElementById('qs-feedback').innerText = "";
            document.getElementById('qs-feedback').className = "feedback-msg";
            document.getElementById('qs-next').style.display = "none";
            const container = document.getElementById('qs-options');
            container.innerHTML = "";
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.attr;
                btn.onclick = () => checkSelectAnswer(opt, btn);
                container.appendChild(btn);
            });
        } else if (type === 'type') {
            qtCurrentItem = getRandomItem();
            document.getElementById('qt-cat').innerText = qtCurrentItem.label;
            document.getElementById('qt-question').innerText = qtCurrentItem.attr;
            document.getElementById('qt-feedback').innerText = "";
            document.getElementById('qt-feedback').className = "feedback-msg";
            document.getElementById('qt-input').value = "";
            document.getElementById('qt-input').disabled = false;
            document.getElementById('qt-next').style.display = "none";
            document.getElementById('qt-input').focus();
        }
    }
    function checkSelectAnswer(selected, btnElement) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.onclick = null);
        const feedback = document.getElementById('qs-feedback');
        if (selected.name === qsCurrentItem.name) {
            btnElement.classList.add('correct');
            feedback.innerText = "Brawo!";
            feedback.classList.add('success');
            qsScore++;
            document.getElementById('qs-score').innerText = qsScore;
        } else {
            btnElement.classList.add('wrong');
            feedback.innerText = "≈πle.";
            feedback.classList.add('error');
            allBtns.forEach(b => { if (b.innerText === qsCurrentItem.attr) b.classList.add('correct'); });
        }
        document.getElementById('qs-next').style.display = "inline-block";
    }
    function checkTypeAnswer() {
        const input = document.getElementById('qt-input');
        const feedback = document.getElementById('qt-feedback');
        const userVal = normalizeString(input.value);
        const correctVal = normalizeString(qtCurrentItem.name);
        if (userVal === "") return;
        input.disabled = true;
        
        if (checkAnswerLogic(userVal, correctVal)) {
            feedback.innerText = "≈öwietnie!";
            feedback.classList.add('success');
            qtScore++;
            document.getElementById('qt-score').innerText = qtScore;
        } else {
            feedback.innerText = `Poprawnie: ${qtCurrentItem.name}`;
            feedback.classList.add('error');
        }
        document.getElementById('qt-next').style.display = "inline-block";
    }
    
    // --- HELPER LOGIC ---
    function normalizeString(str) { return str.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim().replace(/\s{2,}/g," "); }
    
    function checkAnswerLogic(userVal, correctVal) {
        let cleanCorrect = correctVal.replace('≈õw. ', '').replace('≈õwiƒôty ', '').trim();
        if (userVal === correctVal || userVal === cleanCorrect) return true;
        // Check if userVal is in cleanCorrect (e.g. "Piotr" in "≈öw. Piotr")
        if (cleanCorrect.includes(userVal) && userVal.length > 3) return true;
        return false;
    }

    document.getElementById('qt-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            if(document.getElementById('qt-next').style.display === 'none') { checkTypeAnswer(); } 
            else { nextQuizQuestion('type'); }
        }
    });

    // --- TEST CA≈ÅO≈öCIOWY (WRITE) ---
    function renderWriteTest() {
        const container = document.getElementById('write-container');
        const scoreBoard = document.getElementById('write-score');
        container.innerHTML = "";
        scoreBoard.innerText = "";
        scoreBoard.className = "score-board";

        if (currentDeck.length === 0) {
            container.innerHTML = "<p>Brak element√≥w w tej kategorii.</p>";
            return;
        }

        // Kopiujemy i mieszamy
        let questions = [...currentDeck];
        shuffleDeck(questions);

        questions.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'match-row';

            // Kolumna atrybutu
            const attrDiv = document.createElement('div');
            attrDiv.className = 'match-attr';
            attrDiv.innerText = `${index + 1}. ${item.attr}`;
            
            // Kontener na input
            const inputDiv = document.createElement('div');
            inputDiv.style.position = 'relative';

            // Input
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'match-input';
            input.dataset.correct = item.name; // przechowujemy poprawnƒÖ odp
            input.placeholder = "Wpisz imiƒô...";

            // Miejsce na poprawnƒÖ odpowied≈∫ (ukryte)
            const ansDiv = document.createElement('div');
            ansDiv.className = 'correct-answer-text';
            ansDiv.innerText = `Poprawnie: ${item.name}`;

            inputDiv.appendChild(input);
            inputDiv.appendChild(ansDiv);

            row.appendChild(attrDiv);
            row.appendChild(inputDiv);
            container.appendChild(row);
        });
    }

    function checkWriteTest() {
        const inputs = document.querySelectorAll('.match-input');
        let correctCount = 0;
        let total = inputs.length;

        inputs.forEach(input => {
            const userVal = normalizeString(input.value);
            const correctVal = normalizeString(input.dataset.correct);
            const row = input.parentElement;
            const ansText = row.querySelector('.correct-answer-text');

            // Reset
            input.classList.remove('correct', 'wrong');
            ansText.style.display = 'none';

            if (checkAnswerLogic(userVal, correctVal)) {
                input.classList.add('correct');
                correctCount++;
            } else {
                input.classList.add('wrong');
                ansText.style.display = 'block'; // Poka≈º poprawnƒÖ odpowied≈∫
            }
            input.disabled = true;
        });

        const scoreBoard = document.getElementById('write-score');
        const percent = Math.round((correctCount / total) * 100);
        
        scoreBoard.innerHTML = `Tw√≥j wynik: <b>${correctCount} / ${total}</b> (${percent}%)`;
        if (percent === 100) {
            scoreBoard.style.color = "#28a745";
            scoreBoard.innerHTML += " <br>üéâ IMPONUJƒÑCE! MISTRZ I KONOGRAFII! üéâ";
        } else if (percent < 50) {
            scoreBoard.style.color = "#dc3545";
        } else {
            scoreBoard.style.color = "#333";
        }
    }

    // Start
    init();

</script>

</body>
</html>